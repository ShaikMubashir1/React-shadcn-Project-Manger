name: 🚀 Shipping Build
on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: 🚚 Get latest code
        uses: actions/checkout@v4

      - name: 🟢 Use Node.js 22
        uses: actions/setup-node@v4
        with:
          node-version: '22'
          cache: 'npm'

      - name: 🏗 Build (Vite)
        run: |
          npm ci
          npm run build

      # Helps prove whether DNS is the problem
      - name: 🔎 Preflight DNS/ports
        run: |
          echo "Host: ${{ secrets.FTP_SERVER }}"
          getent hosts "${{ secrets.FTP_SERVER }}" || (echo "DNS failed"; exit 1)
          command -v nc >/dev/null && {
            nc -vz "${{ secrets.FTP_SERVER }}" 21 || true
            nc -vz "${{ secrets.FTP_SERVER }}" 990 || true
          }

      - name: 📂 Deploy via FTPS (Explicit 21)
        uses: SamKirkland/FTP-Deploy-Action@4.3.3
        with:
          server:   ${{ secrets.FTP_SERVER }}      # hostname or IP
          username: ${{ secrets.FTP_USERNAME }}    # mubashir@shoaib.standardtouch.com
          password: ${{ secrets.FTP_PASSWORD }}
          protocol: ftps
          port: 21
          local-dir: dist/                         # Vite output
          # server-dir: /public_html/              # uncomment if needed
